---
import BaseLayout from '../layouts/BaseLayout.astro';
import Header from '../components/Header.astro';
import Navigation from '../components/Navigation.astro';
import Footer from '../components/Footer.astro';
---

<BaseLayout title="Mirror Drift Monitor | Empirica">
    <Header slot="header" />
    <Navigation slot="navigation" />
    <!-- Hero Section -->
    <section class=" text-white py-20">
        <div class="max-w-5xl mx-auto px-6">
            <h1 class="text-5xl font-bold mb-6">
                Mirror Drift Monitor
            </h1>
            <p class="text-2xl text-purple-200 mb-8">
                Temporal self-validation: Your past reflects back to validate your present
            </p>
            <p class="text-lg text-slate-300 max-w-3xl">
                The Mirror Drift Monitor detects significant drops in epistemic capability by comparing current assessments to historical baselines. It's pure temporal comparison - no heuristics, no external LLMs, just your own past performance as the mirror.
            </p>
        </div>
    </section>

    <!-- Core Concept -->
    <section class="py-20 glass-card">
        <div class="max-w-5xl mx-auto px-6">
            <h2 class="text-4xl font-bold text-white mb-6">
                The Mirror Principle
            </h2>
            <p class="text-xl text-slate-400 mb-12">
                Your recent epistemic state is the most reliable baseline for detecting problems
            </p>

            <div class="grid md:grid-cols-3 gap-8 mb-12">
                <div class="bg-gradient-to-br from-indigo-50 to-purple-50 rounded-xl p-6 border-l-4 border-indigo-600">
                    <h3 class="text-xl font-bold text-white mb-3">1. Establish Baseline</h3>
                    <p class="text-slate-300">
                        Average your last 5 checkpoints to create a performance baseline
                    </p>
                </div>

                <div class="bg-gradient-to-br from-purple-50 to-pink-50 rounded-xl p-6 border-l-4 border-purple-600">
                    <h3 class="text-xl font-bold text-white mb-3">2. Compare Current</h3>
                    <p class="text-slate-300">
                        Measure current epistemic vectors against the baseline
                    </p>
                </div>

                <div class="bg-gradient-to-br from-pink-50 to-red-50 rounded-xl p-6 border-l-4 border-pink-600">
                    <h3 class="text-xl font-bold text-white mb-3">3. Flag Drops</h3>
                    <p class="text-slate-300">
                        Alert on significant drops (‚â•20% default) - increases are expected from learning
                    </p>
                </div>
            </div>

            <!-- Diagram -->
            <div class="bg-slate-900 rounded-xl p-8">
                <img src="/assets/epistemic_feedback_loop.svg" 
                     alt="Epistemic Feedback Loop" 
                     class="w-full glass-card rounded-lg p-6" />
                <p class="text-sm text-slate-400 text-center mt-4 italic">
                    PREFLIGHT ‚Üí Action ‚Üí POSTFLIGHT ‚Üí Calibration ‚Üí Drift Detection Loop
                </p>
            </div>
        </div>
    </section>

    <!-- What Gets Detected -->
    <section class="py-20 ">
        <div class="max-w-5xl mx-auto px-6">
            <h2 class="text-4xl font-bold text-white mb-12">
                What Gets Detected
            </h2>

            <div class="space-y-8">
                <div class="glass-card rounded-xl  p-8">
                    <div class="flex items-start">
                        <div class="w-12 h-12 bg-red-500 rounded-lg flex items-center justify-center text-white font-bold text-xl mr-4 flex-shrink-0">
                            ‚ö†
                        </div>
                        <div>
                            <h3 class="text-2xl font-bold text-white mb-3">Capability Drops</h3>
                            <p class="text-slate-300 mb-4">
                                Unexpected decreases in KNOW or DO vectors indicate lost knowledge or degraded ability
                            </p>
                            <div class="bg-red-50 border-l-4 border-red-500 p-4 rounded">
                                <p class="text-sm text-red-900">
                                    <strong>Example:</strong> KNOW was 0.8 for the last 5 sessions, suddenly drops to 0.5 ‚Üí Context loss detected
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="glass-card rounded-xl  p-8">
                    <div class="flex items-start">
                        <div class="w-12 h-12 bg-amber-500 rounded-lg flex items-center justify-center text-white font-bold text-xl mr-4 flex-shrink-0">
                            üß†
                        </div>
                        <div>
                            <h3 class="text-2xl font-bold text-white mb-3">Context Loss</h3>
                            <p class="text-slate-300 mb-4">
                                Degradation in CONTEXT or CLARITY vectors signals loss of working memory or understanding
                            </p>
                            <div class="bg-amber-50 border-l-4 border-amber-500 p-4 rounded">
                                <p class="text-sm text-amber-900">
                                    <strong>Example:</strong> CONTEXT was 0.9, drops to 0.6 ‚Üí Session interrupted or context window exceeded
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="glass-card rounded-xl  p-8">
                    <div class="flex items-start">
                        <div class="w-12 h-12 bg-purple-500 rounded-lg flex items-center justify-center text-white font-bold text-xl mr-4 flex-shrink-0">
                            üìâ
                        </div>
                        <div>
                            <h3 class="text-2xl font-bold text-white mb-3">Overconfidence Patterns</h3>
                            <p class="text-slate-300 mb-4">
                                UNCERTAINTY too low for complex tasks may indicate overconfidence bias
                            </p>
                            <div class="bg-purple-50 border-l-4 border-purple-500 p-4 rounded">
                                <p class="text-sm text-purple-900">
                                    <strong>Example:</strong> Task complexity high but UNCERTAINTY = 0.1 ‚Üí Overconfident, may rush
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="mt-12 bg-green-50 border-l-4 border-green-600 p-6 rounded-lg">
                <h4 class="font-semibold text-green-900 mb-2">‚úì Increases are EXPECTED</h4>
                <p class="text-green-800">
                    The drift monitor only flags DROPS. When KNOW or DO increase, that's learning - exactly what we want!
                </p>
            </div>
        </div>
    </section>

    <!-- No Heuristics Design -->
    <section class="py-20 glass-card">
        <div class="max-w-5xl mx-auto px-6">
            <h2 class="text-4xl font-bold text-white mb-6">
                Pure Temporal Comparison
            </h2>
            <p class="text-xl text-slate-400 mb-12">
                No guesswork, no keyword matching, no external validation
            </p>

            <div class="grid md:grid-cols-2 gap-8">
                <div class="bg-red-50 rounded-xl p-6">
                    <h3 class="text-xl font-bold text-red-900 mb-4">‚ùå What it does NOT do</h3>
                    <ul class="space-y-2 text-red-800">
                        <li>‚Ä¢ Use keyword matching to classify domains</li>
                        <li>‚Ä¢ Apply heuristic rules about what "should" happen</li>
                        <li>‚Ä¢ Require external LLMs for validation</li>
                        <li>‚Ä¢ Make assumptions about task types</li>
                    </ul>
                </div>

                <div class="bg-green-50 rounded-xl p-6">
                    <h3 class="text-xl font-bold text-green-900 mb-4">‚úÖ What it DOES do</h3>
                    <ul class="space-y-2 text-green-800">
                        <li>‚Ä¢ Load recent checkpoints from Git</li>
                        <li>‚Ä¢ Calculate baseline by averaging historical vectors</li>
                        <li>‚Ä¢ Detect statistical drops (current ‚â™ baseline)</li>
                        <li>‚Ä¢ Integrate seamlessly with CASCADE workflow</li>
                    </ul>
                </div>
            </div>

            <div class="mt-12 bg-indigo-50 border-l-4 border-indigo-600 p-6 rounded-lg">
                <h4 class="font-semibold text-indigo-900 mb-2">Why no heuristics?</h4>
                <p class="text-indigo-800">
                    Heuristics are brittle and require constant maintenance. Pure temporal comparison is elegant: your past performance is always the right baseline for your current context.
                </p>
            </div>
        </div>
    </section>

    <!-- Integration with Storage -->
    <section class="py-20 ">
        <div class="max-w-5xl mx-auto px-6">
            <h2 class="text-4xl font-bold text-white mb-6">
                Git-Native Storage Integration
            </h2>
            <p class="text-xl text-slate-400 mb-12">
                Drift detection powered by compressed checkpoints in Git notes
            </p>

            <div class="glass-card rounded-xl  p-8 mb-8">
                <h3 class="text-2xl font-bold text-white mb-4">Checkpoint-Based Architecture</h3>
                <p class="text-slate-300 mb-6">
                    The drift monitor uses the PRIMARY storage tier (checkpoint_manager) for lightweight, frequent comparisons:
                </p>

                <div class="bg-slate-900 text-slate-300 rounded-lg p-6 font-mono text-sm mb-6">
                    <div class="mb-2 text-cyan-400"># Load last 5 checkpoints (~200 bytes each)</div>
                    <div>recent = checkpoint_manager.load_recent_checkpoints(</div>
                    <div class="ml-4">session_id=session_id,</div>
                    <div class="ml-4">count=5  <span class="text-slate-500"># ~1KB total</span></div>
                    <div>)</div>
                    <div class="mt-4 mb-2 text-cyan-400"># Calculate baseline (simple average)</div>
                    <div>baseline = calculate_baseline(recent)</div>
                    <div class="mt-4 mb-2 text-cyan-400"># Detect drops ‚â•20%</div>
                    <div>drift = detect_drift(current, baseline)</div>
                </div>

                <div class="grid md:grid-cols-3 gap-4">
                    <div class="bg-indigo-50 rounded-lg p-4">
                        <div class="text-2xl font-bold text-indigo-600 mb-1">~1KB</div>
                        <div class="text-sm text-slate-300">Total data for drift detection</div>
                    </div>
                    <div class="bg-purple-50 rounded-lg p-4">
                        <div class="text-2xl font-bold text-purple-600 mb-1">&lt;10ms</div>
                        <div class="text-sm text-slate-300">Drift calculation time</div>
                    </div>
                    <div class="bg-pink-50 rounded-lg p-4">
                        <div class="text-2xl font-bold text-pink-600 mb-1">0</div>
                        <div class="text-sm text-slate-300">External API calls needed</div>
                    </div>
                </div>
            </div>

            <div class="bg-slate-900 rounded-xl p-8">
                <img src="/assets/three_layer_architecture.svg" 
                     alt="Three-Layer Architecture" 
                     class="w-full glass-card rounded-lg p-6" />
                <p class="text-sm text-slate-400 text-center mt-4 italic">
                    Sentinel (Governance) ‚Üí Git Notes (Epistemic State) ‚Üí Git (Content) - Triple Storage Architecture
                </p>
            </div>
        </div>
    </section>

    <!-- Configuration -->
    <section class="py-20 glass-card">
        <div class="max-w-5xl mx-auto px-6">
            <h2 class="text-4xl font-bold text-white mb-6">
                Configuration & Tuning
            </h2>
            <p class="text-xl text-slate-400 mb-12">
                Adjust sensitivity based on your use case
            </p>

            <div class="grid md:grid-cols-3 gap-6 mb-8">
                <div class="bg-gradient-to-br from-red-50 to-amber-50 rounded-xl p-6 border-2 border-red-200">
                    <h3 class="text-lg font-bold text-white mb-2">Sensitive</h3>
                    <div class="text-3xl font-bold text-red-600 mb-2">10%</div>
                    <p class="text-sm text-slate-300 mb-3">drift_threshold = 0.1</p>
                    <p class="text-xs text-slate-400">
                        Triggers on small drops. Good for critical systems where any degradation matters.
                    </p>
                </div>

                <div class="bg-gradient-to-br from-indigo-50 to-purple-50 rounded-xl p-6 border-2 border-indigo-400">
                    <h3 class="text-lg font-bold text-white mb-2">Balanced ‚≠ê</h3>
                    <div class="text-3xl font-bold text-indigo-600 mb-2">20%</div>
                    <p class="text-sm text-slate-300 mb-3">drift_threshold = 0.2</p>
                    <p class="text-xs text-slate-400">
                        Default setting. Catches significant drops without false positives.
                    </p>
                </div>

                <div class="bg-gradient-to-br from-slate-50 to-slate-100 rounded-xl p-6 border-2 border-slate-300">
                    <h3 class="text-lg font-bold text-white mb-2">Conservative</h3>
                    <div class="text-3xl font-bold text-slate-400 mb-2">30%</div>
                    <p class="text-sm text-slate-300 mb-3">drift_threshold = 0.3</p>
                    <p class="text-xs text-slate-400">
                        Only major drops trigger alerts. Good for exploratory work with high variability.
                    </p>
                </div>
            </div>

            <div class="bg-slate-900 text-slate-300 rounded-xl p-6 font-mono text-sm">
                <div class="text-cyan-400 mb-4"># Python configuration</div>
                <div>from empirica.core.drift.mirror_drift_monitor import MirrorDriftMonitor</div>
                <div class="mt-4">monitor = MirrorDriftMonitor(</div>
                <div class="ml-4">drift_threshold=0.2,  <span class="text-slate-500"># 20% drop triggers alert</span></div>
                <div class="ml-4">lookback_window=5,    <span class="text-slate-500"># Compare to last 5 checkpoints</span></div>
                <div class="ml-4">min_history=3         <span class="text-slate-500"># Need 3+ checkpoints to start</span></div>
                <div>)</div>
            </div>
        </div>
    </section>

    <!-- Usage Examples -->
    <section class="py-20 ">
        <div class="max-w-5xl mx-auto px-6">
            <h2 class="text-4xl font-bold text-white mb-12">
                Automatic CASCADE Integration
            </h2>

            <div class="glass-card rounded-xl  p-8 mb-8">
                <h3 class="text-2xl font-bold text-white mb-4">It Just Works‚Ñ¢</h3>
                <p class="text-lg text-slate-300 mb-6">
                    The drift monitor automatically integrates with CASCADE workflow - no extra setup needed:
                </p>

                <div class="space-y-4">
                    <div class="flex items-start">
                        <div class="w-8 h-8 bg-indigo-600 rounded-lg flex items-center justify-center text-white font-bold mr-4 flex-shrink-0">
                            1
                        </div>
                        <div>
                            <h4 class="font-semibold text-white">PREFLIGHT creates checkpoint</h4>
                            <p class="text-sm text-slate-400">Initial assessment stored in Git notes</p>
                        </div>
                    </div>
                    <div class="flex items-start">
                        <div class="w-8 h-8 bg-cyan-600 rounded-lg flex items-center justify-center text-white font-bold mr-4 flex-shrink-0">
                            2
                        </div>
                        <div>
                            <h4 class="font-semibold text-white">CHECK queries drift monitor</h4>
                            <p class="text-sm text-slate-400">Compares current state to baseline automatically</p>
                        </div>
                    </div>
                    <div class="flex items-start">
                        <div class="w-8 h-8 bg-purple-600 rounded-lg flex items-center justify-center text-white font-bold mr-4 flex-shrink-0">
                            3
                        </div>
                        <div>
                            <h4 class="font-semibold text-white">POSTFLIGHT validates learning</h4>
                            <p class="text-sm text-slate-400">Confirms epistemic growth vs unexpected drops</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="bg-gradient-to-br from-indigo-50 to-purple-50 border-l-4 border-indigo-600 p-6 rounded-lg">
                <h4 class="font-semibold text-indigo-900 mb-2">Statusline Integration</h4>
                <p class="text-indigo-800 mb-4">
                    The drift monitor powers the statusline display, showing real-time epistemic state:
                </p>
                <div class="bg-slate-900 text-green-400 font-mono text-sm p-4 rounded">
                    üß† K:0.75 D:0.80 U:0.25 [STABLE] (last updated: 2s ago)
                </div>
                <p class="text-xs text-indigo-700 mt-2">
                    Status changes to [DRIFTING] when drops detected, [OVERCONFIDENT] when uncertainty too low
                </p>
            </div>
        </div>
    </section>

    <!-- CTA -->
    <section class="py-20 text-white">
        <div class="max-w-4xl mx-auto px-6 text-center">
            <h2 class="text-4xl font-bold mb-6">
                Monitor Your Epistemic State
            </h2>
            <p class="text-xl mb-8 text-white/90">
                Drift detection starts automatically with your first CASCADE workflow
            </p>
            <div class="flex gap-4 justify-center">
                <a href="/getting-started.html"
                    class="glass-card text-indigo-600 px-8 py-4 rounded-lg font-semibold hover:bg-slate-100 transition-all transform hover:scale-105">
                    Get Started
                </a>
                <a href="/how-it-works.html"
                    class="glass-card/10 border-2 border-white text-white px-8 py-4 rounded-lg font-semibold hover:glass-card/20 transition-all">
                    Learn CASCADE
                </a>
            </div>
        </div>
    </section>
    <Footer slot="footer" />
</BaseLayout>
